---
title: "Exer2_graficos"
date: "11/30/2019"
output: html_document
---
```{r}

library(dplyr)
library(tidyr)
library(ggplot2)

```


Lendo o arquivo e gerando um dataset com as princiapais variaveis.

```{r}
df <- read.csv2('datasets/CEAPS.csv', encoding="Latin-ASCII",stringsAsFactors = FALSE)

df_gastos <- df %>%
  select(ANO, MES, SENADOR, VALOR_REEMBOLSADO)

df_gastos$SENADOR <- iconv(df_gastos$SENADOR, "latin1", "UTF-8")

df_gastos$VALOR_REEMBOLSADO <-as.numeric(gsub(",", ".", as.character(df_gastos$VALOR_REEMBOLSADO)))
```


```{r}
g_2018 <- filter(df_gastos, ANO == 2018)
g_2018 <- group_by(g_2018, SENADOR) %>%
  summarise(Total = sum(VALOR_REEMBOLSADO))
g_2018
```

Os 10 Senadores que mais tevera
```{r}
g_2018_ord <- g_2018[order(-g_2018$Total),]
ggplot(data = g_2018_ord[1:10,], aes(x = reorder(SENADOR, Total), y = Total)) +  
  geom_bar(stat = "identity") +
  coord_flip() 

```

Outra maneira de fazer os top 10.

```{r}
g_2018 %>%
  top_n(10, Total) %>%
  ggplot(aes(x=reorder(SENADOR, Total), y = Total),) + 
  geom_col(aes(fill = Total)) +
  xlab("Senadores") + ylab("Valores Reembolsados em 2018") +
  coord_flip()

```

Senador que mais teve reembolso.

```{r}
top_reemb <- group_by(df_gastos, SENADOR) %>%
  summarise(Total = sum(VALOR_REEMBOLSADO)) %>%
  arrange(desc(Total))
top_reemb
```

Gráfico em linha com evolução do Senador com maior valor total reembolsado.

```{r}
senador <- df_gastos %>%
  filter(SENADOR == top_reemb$SENADOR[1]) %>%
  group_by(ANO) %>%
  summarise(Total = sum(VALOR_REEMBOLSADO))

senador %>%
  ggplot() + 
  geom_line(aes(x=ANO, y=Total/1000), size=1) +
  xlim(2007,2020) + ylab("Valores em K") 

```

```{r}
top_reemb %>%
  top_n(200, Total) %>%
  ggplot(aes(x=Total)) + 
  geom_histogram(fill="skyblue")

```







